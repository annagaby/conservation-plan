---
title: "data_cp"
author: "Anna Calle"
date: "10/24/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Load packages
library(tidyverse)
library(sf)
library(sp)
library(rgdal)
library(raster)
library(dplyr)
library(rgeos)
library(scales)
library(fasterize)
library(dismo)
library(maptools)
library(sdmpredictors)
library(maps)
library(ncdf4)
library(marmap)
library(lwgeom)
```


```{r}
# Setup for downloading data using drive file stream

# Create root based on OS
if(Sys.info()["sysname"] == "Windows"){
  team_path <- "G:/"
} else {
  team_path <- "/Volumes/GoogleDrive/"
}

#Create full file path
path <- paste0(team_path, "My Drive/conservation-plan/data/shapefiles")

```



# Read data
```{r}
# Read all layers (excluding GBIF and Bio-ORACLE)

# EEZ
eez <- read_sf(dsn = path,
                layer = "eez_v10")

# Depth
depth <- raster(paste0(path,"/gebco_2019_n7.045066_s-35.78779_w-54.58321_e-26.01452.tif"))

# Layers to be excluded

# Reefs (marine ecosystems layer)
reefs <-  read_sf(dsn = path,
                layer = "apzcm_alvo_ecossistemas_marinhos")

# Artificial reefs
reefs_artificial <-  read_sf(dsn = path,
                layer = "Artificial_Reefs")

# MPAs polygons
mpas <- read_sf(dsn = path,
                layer = "WDPA_Oct2019_marine-shapefile-polygons")

# No take zones
no_take <-  read_sf(dsn = path,
                layer = "No_Take_Zone_ACREshp")

# Important wetlands Ramsar
wetlands <-  read_sf(dsn = path,
                layer = "Important_Wetlands_Ramsar")



```

# Plot data 
```{r}
# EEZ
# First filter data for only Brazil
eez_BRA <- eez %>% 
  filter(ISO_Ter1=="BRA")

ggplot( data = eez_BRA) +
  geom_sf()
```


```{r}
# Depth
plot(depth)

hist(depth)
```

```{r}
# Boundaries
plot(bound_BRA$geometry)
```



```{r}
# MPAS
# First filter data only for Brazil
mpas_BR <- mpas %>% 
  filter(ISO3 == "BRA")

ggplot( data = mpas_BR) +
  geom_sf()

```


```{r}
# Ports
ggplot( data = ports) +
  geom_sf()

```

```{r}
# Reefs
ggplot( data = reefs) +
  geom_sf()

```

```{r}
# No take zones
ggplot( data = no_take) +
  geom_sf()
```

```{r}
# Important wetlands Ramsar
ggplot( data = wetlands) +
  geom_sf()
```

```{r}
# Artificial coral reefs
ggplot( data = reefs_artificial) +
  geom_sf()
```


Buffering mpas
```{r}
mpas_buffer <- mpas_BR %>% 
  st_centroid() %>% 
  st_buffer(dist = 0.5) %>% # need to figure out how to use distance units
  st_union()

ggplot(mpas_buffer) +
  geom_sf()
```

Download SST from Bio-Oracle
```{r}
# Explore datasets in the package 
list_datasets() 

# Explore layers in a dataset 
list_layers() 

# Download max and min sst layers
min_sst <- load_layers("BO_sstmin")
max_sst <- load_layers("BO_sstmax")
```

Download Current Velocity from Bio-Oracle
```{r}
# Explore datasets in the package 
list_datasets() 

# Explore layers in a dataset 
list_layers() 

# Download max current velocity layers at minimum depth
max_cv <- load_layers("BO2_curvelmax_bdmin")

```

Visualize Current Velocity Data
```{r}
# Histograms
hist(max_cv)

# Plots
plot(max_cv)

```

Cropping SST to eez
```{r}
max_sst_BR <- crop(max_sst, eez_BRA)
min_sst_BR <- crop(min_sst, eez_BRA)

max_sst_BRA <- mask(max_sst_BR, eez_BRA)
min_sst_BRA <- mask(min_sst_BR, eez_BRA)

plot(max_sst_BRA)
```

Cropping depth to eez
```{r}
# Crop
depth_BR <- crop(depth, eez_BRA)

# Mask
depth_BRA <- mask(depth_BR, eez_BRA)
beep()

# Resample so it has same resolution as SST layers
depth_BRA_res <- resample(depth_BRA, min_sst_BRA,method='ngb',progress='text')

plot(depth_BRA_res)
```



```{r}


```


