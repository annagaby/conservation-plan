---
title: "data_cp"
author: "Anna Calle"
date: "10/24/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Load packages
library(tidyverse)
library(sf)
library(sp)
library(rgdal)
library(raster)
library(dplyr)
library(rgeos)
library(scales)
library(fasterize)
library(dismo)
library(rJava)
library(maptools)
library(sdmpredictors)
library(maps)
library(ncdf4)
library(marmap)
```


```{r}
# Setup for downloading data using drive file stream

# Create root based on OS
if(Sys.info()["sysname"] == "Windows"){
  team_path <- "G:/"
} else {
  team_path <- "/Volumes/GoogleDrive/"
}

#Create full file path
path <- paste0(team_path, "My Drive/conservation-plan/data/shapefiles")

```



# Read data
```{r}
# Read all layers (excluding GBIF and Bio-ORACLE)

# EEZ
eez <- read_sf(dsn = path,
                layer = "eez")

# Depth
depth <- nc_open(paste0(path,"/GEBCO_2019_SID.nc"))


# Reefs
reefs <-  read_sf(dsn = path,
                layer = "reef_500_poly")

# MPAs
mpas <- read_sf(dsn = path,
                layer = "WDPA_Mar2018_marine-shapefile-polygons")

# Ports
ports <- read_sf(dsn = path,
                layer = "tra_edif_const_portuaria_p")

# Aquaculture

aquaculture <-  read_sf(dsn = path,
                layer = "Aquaculture")

# No take zones

no_take <-  read_sf(dsn = path,
                layer = "No_Take_Zone_ACREshp")

# Important wetlands Ramsar

wetlands <-  read_sf(dsn = path,
                layer = "Important_Wetlands_Ramsar")

# Artificial reefs

reefs_artificial <-  read_sf(dsn = path,
                layer = "Artificial_Reefs")


```


```{r}
# EEZ
ggplot( data = eez) +
  geom_sf()
```



```{r}
# MPAS
# First filter data only for Brazil
mpas_BR <- mpas %>% 
  filter(ISO3 == "BRA")

ggplot( data = mpas_BR) +
  geom_sf()

```


```{r}
# Ports
ggplot( data = ports) +
  geom_sf()

```

```{r}
# Reefs
ggplot( data = reefs) +
  geom_sf()

```



```{r}
# Aquaculture
ggplot( data = aquaculture) +
  geom_sf()
```

```{r}
# No take zones
ggplot( data = no_take) +
  geom_sf()
```

```{r}
# Important wetlands Ramsar
ggplot( data = wetlands) +
  geom_sf()
  ggplot(data = world) +
  geom_sf
```

```{r}
# Artificial coral reefs
ggplot( data = reefs_artificial) +
  geom_sf()
```

# Buffering mpas
```{r}
mpas_buffer <- mpas_BR %>% 
  st_centroid() %>% 
  st_buffer(dist = 0.5) %>% # need to figure out how to use distance units
  st_union()

ggplot(mpas_buffer) +
  geom_sf()
```

# Writing netcdf file ss geotiff
```{r}
# function to read bathy data

depth_gebco <- readGEBCO.bathy("GEBCO_2019_SID.nc", resolution = 1, sid = FALSE)


depth_gebco <- readGEBCO.bathy(paste0(path,"/GEBCO_2019_SID.nc"))
```

```{r}
# function to reproject sf objects (maybe all kinds of objects)
reproject_crop <- function(data){
  st_transform(data, "+proj=longlat +datum=WGS84 +no_defs") %>% 
  st_intersection(eez)
}

reproject_crop(reefs)



reefs <-  st_transform(reefs, "+proj=longlat +datum=WGS84 +no_defs")
reefs_cropped <- st_intersection(reefs, eez)

aquaculture <- st_transform(aquaculture, "+proj=longlat +datum=WGS84 +no_defs")
aquaculture_cropped <-crop( aquaculture, eez)

```


