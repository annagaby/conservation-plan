---
title: "cobia-range"
author: "Anna Calle"
date: "10/2/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
# Load packages and read files
library(tidyverse)
library(sf)
library(raster)
library(rgdal)
library(dplyr)
library(rgeos)
library(scales)
library(fasterize)
library(dismo)
library(rJava)
library(maptools)
library(sdmpredictors)
library(maps)
library(mapdata)
```

# Projection and Extent
```{r}
# set up projection parameter for use throughout script
projection <- "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"

#set up extent parameter for use throughout script
ext <- extent(-180, 180, -90, 90)
```

# Ocurrence data
```{r}
# Read in clean data
cobia_sample <- read_csv("cobia_sample.csv")

# Convert to data frame
cobia_sample <- as.data.frame(cobia_sample)
```


# Environmental variables
```{r}
# Explore datasets in the package 
list_datasets() 

# Explore layers in a dataset 
list_layers() 

# Download specific layers to current directory. In this case we are downloading mean sea surface temperature, max sea surface temperature, min sea surface temperature, dissolved oxygen, and sea surface salinity
files <- load_layers(c("BO_sstmax", "BO_sstmin", "BO_dissox", "MS_biogeo08_sss_mean_5m")) 

# Make a rasterLayer with predictor variables
predictors <- stack(files)

```

# Maxent requirements 
```{r}
# Before running maxent using the 'dismo' package:
# - download maxent program from http://www.cs.princeton.edu/~schapire/maxent/
# -  Put the file ’maxent.jar’ in the ’java’ folder of the ’dismo’ package. That is the folder returned by system.file("java", package="dismo")

```


# Maxent
```{r}
# Run Maxent if java file is in the correct folder

jar <- paste(system.file(package="dismo"), "/java/maxent.jar", sep='')

if (file.exists(jar)) {
  # Fit maxent model
  cobia_model <- maxent(predictors, p = cobia_sample)
  
 # Plot showing importance of every variable
 plot(cobia_model)
 
 # Response curves
 response(cobia_model)
 
 # Predict the entire dataset
 cobia_pred <- predict(cobia_model, predictors)
 
 # Plot predictions
 plot(cobia_pred, main = "Predicted Suitability")
 map('worldHires', fill=FALSE, add=TRUE)
points(cobia_sample$lon, cobia_sample$lat, pch="+", cex=0.2)

} else {
  cat('cannot run this example because maxent is not available') + plot(1)
}


# Fix!!! map boundaries are not matching prediction layer
```

